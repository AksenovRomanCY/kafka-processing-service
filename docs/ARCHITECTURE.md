# Architecture

## üìå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Kafka Consumer (Python + aiokafka)

- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka `input`
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç JSON –∏ –Ω–∞–ª–∏—á–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è `value`
- –û—à–∏–±–∫–∏ ‚Äî –≤ Kafka `error`
- –í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `task_1`
- Offset –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é

### 2. Celery Worker (Python + Redis)

#### `task_1`:
- –ü–æ–ª—É—á–∞–µ—Ç —á–∏—Å–ª–æ, –ø–µ—á–∞—Ç–∞–µ—Ç –µ–≥–æ
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 30%
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç 100 –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç `task_2`

#### `task_2`:
- –ü–æ–ª—É—á–∞–µ—Ç —á–∏—Å–ª–æ, –ø–µ—á–∞—Ç–∞–µ—Ç
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 30%
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –≤—ã—á–∏—Ç–∞–µ—Ç 1000 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Kafka `output` –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{ "result": <—á–∏—Å–ª–æ> }
```

–û–±–µ –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `autoretry_for`, `retry_backoff`, `max_retries=3`.

## üîÅ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

![–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](img/message-flow.png)
